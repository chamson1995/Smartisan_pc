
class Banner{constructor(selector,bannerList){this.selector=selector;this.length=bannerList.length;this.index=0;this.timer=null;this.setBanner(bannerList);this.setDots();}
setBanner(bannerList){var images="";var dots="";bannerList.forEach((list,index)=>{images+="<a href='"+list.link+"' class='banner-slide"+(index==0?" banner-pagination-bullet-active":"")+"' "+(index==0?"style='opacity:1'":"")+">"+"<img alt='banner' class='banner-img' src='"+list.image+"?x-oss-process=image/resize,w_1220'>"+"</a>";dots+="<span class='banner-pagination-bullet'></span>";});var bannerContainer="<div class='banner-container'>"+"<div class='banner-wrapper'>"+images+"</div>"+"<div class='banner-pagination'>"+dots+"</div>"+"</div>";$(".banner").append(bannerContainer);}
setDots(){var _this=this;$(".banner-pagination").on('click',function(e){var evt=window.event||e;_this.index=$(evt.target).index();_this.goto(_this.index);});}
goto(index){index=index%this.length;$(this.selector+" .banner-wrapper").children().eq(index).css({opacity:1}).siblings().css({opacity:0});$(this.selector+" .banner-pagination").children().eq(index).addClass("banner-pagination-bullet-active").siblings().removeClass("banner-pagination-bullet-active");this.autoplay();}
autoplay(){clearInterval(this.timer);var _this=this;_this.timer=setInterval(()=>{_this.index=(_this.index+1)%_this.length;_this.goto(_this.index);},2500);}}
class HomeActivities{constructor(activitiesList){this.activitiesList=activitiesList;this.setActivities();}
setActivities(){var activities="";this.activitiesList.forEach(list=>{activities+="<figure class='advertise'>"+"<img src='"+list.image+"'>"+"<a href='"+list.link+"' class='ad-click-mask'></a>"+"</figure>";});$(".activities-wrap").append(activities);}}
class IndexGoodsList{constructor(fatherSelector,dataList,isRefresh){this.fatherSelector=fatherSelector;this.dataList=dataList;this.isRefresh=isRefresh;this.setAll();this.setHoverColor();}
getItem(sku,index){var color="";if(sku.skuList.length>1){sku.skuList.forEach((list,index)=>{if(list.skuColor!=""){color+="<figure class = 'outer "+(index==0?"active":"")+"' >"+"<img src = '"+list.skuColor+"?x-oss-process=image/resize,w_20'>"+"</figure>";}});}
var item="<section  class='spu-item-normal-box' index='"+index+"'>"+"<figure class='item-cover'>"+"<img src='"+sku.spuInfo.images+"?x-oss-process=image/resize,w_216'>"+"</figure>"+"<article>"+"<h3>"+sku.spuInfo.spuTitle+"</h3>"+"<h5 class='txt-product-title'>"+sku.spuInfo.spuSubTitle+"</h5>"+"</article>"+"<aside class='item-attr-colors'>"+color+"</aside>"+"<article class='item-price'>"+"<span>¥ "+sku.spuInfo.discountPrice+"</span>"+"<span class='orignal-price'>"+sku.spuInfo.price+"</span>"+"</article>"+"<div class='activity-tag'>"+(sku.spuInfo.tagText==""?"":"<span class='"+(sku.spuInfo.tagText=="满减"?"red":"yellow")+"'>"+sku.spuInfo.tagText+"</span>")+"</div>"+"<div class='markup-tag'></div>"+"</section>";return item;}
setAll(){var all="";this.dataList.forEach((list,index)=>{all+=this.getItem(list,index);});if(this.isRefresh)$('.category-list').empty();$(this.fatherSelector).append(all);}
setHoverColor(){var _this=this;$(".item-attr-colors figure").on("mouseenter",function(e){var evt=window.event||e;var colorIndex=$(evt.target).index();var index=$(this).parent().parent().attr("index");var thisTitle="<h3>"+_this.dataList[index].skuList[colorIndex].skuTitle+"</h3>"+"<h5 class='txt-product-title'>"+_this.dataList[index].skuList[colorIndex].skuSubTitle+"</h5>";var thisImage="<img src='"+_this.dataList[index].skuList[colorIndex].images+"?x-oss-process=image/resize,w_216'>";var thisPrice="<span>¥ "+_this.dataList[index].skuList[colorIndex].discountPrice+"</span>"+"<span class='orignal-price'>"+_this.dataList[index].skuList[colorIndex].originalPrice+"</span>";$(this).parent().prev().empty().append(thisTitle).prev().empty().append(thisImage);$(this).parent().next().empty().append(thisPrice);$(this).addClass("active").siblings().removeClass("active");});}}
function _3dHover(selector){var h=$(selector).height();var w=$(selector).width();$(".banner").on('mousemove',function(e){var evt=window.event||e;$(selector).css({transition:"none",transform:"rotateX("+-(evt.offsetY-h/2)/h+"deg) rotateY("+(evt.offsetX-w/2)/w+"deg)",boxShadow:-(evt.offsetX-w/2)/w*20+"px "+-(evt.offsetY-h/2)/h*20+"px 10px 0 rgba(0,0,0,0.2)"});});$(".banner").on('mouseleave',function(e){var evt=window.event||e;$(selector).css({transition:"0.15s ease-in-out",transform:"rotateX(0deg) rotateY(0deg)",boxShadow:"0 0 10px 0px rgba(0,0,0,0.2)"});});}
$.ajax({url:"/home/product/home",dataType:"json",success:function(response){var banner=new Banner(".banner",response.data.home_carousel);banner.autoplay();var activities=new HomeActivities(response.data.home_activities);}});